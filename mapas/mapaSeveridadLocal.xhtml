<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui">

<h:body>

	<ui:composition template="../template/template.xhtml">
		<ui:define name="content">


			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdR06M2wq1XRh73M-egCkmnuD3Vzw91SU" type="text/javascript" />

			<h:form id="frmMapa">
				<br/>
				<p:fieldset legend="#{messages.severidad_local_historico}">

					<p:panelGrid columns="2" style="width: 100%">

						<p:panelGrid id="panelFecha" columns="1" style="width: 100%; text-align:right">

							<h:outputLabel value="#{messages.seleccionar_fecha_hora}:" />
							<p:calendar id="idCalendarSelection" value="#{mapsLoaderMB.selectedDate}" pattern="dd/MM/yyyy HH:mm" showButtonPanel="true" widgetVar="wvCalendarSelection" locale="#{loginMBean.locale}">
								<p:ajax event="dateSelect" oncomplete="reloadMaps()" />
							</p:calendar>

						</p:panelGrid>
					</p:panelGrid>



					<p:panelGrid columns="3" style="width: 100%">

						<p:panelGrid columns="1" style="width: 100%">
							<h:outputLabel value="#{messages.ultimas_6_horas}" />
							<div id="map6" style="height: 700px">
								<div id="gmap6" class="fill"></div>
								<div id="olmap6" class="fill"></div>
							</div>
							<div id="wrapper6">
								<div id="location6" style="float: right"></div>
								<div id="scale6" class="escala"></div>
							</div>
						</p:panelGrid>

						<p:panelGrid columns="1" style="width: 100%">
							<h:outputLabel value="#{messages.ultimas_3_horas}" />
							<div id="map3" style="height: 700px">
								<div id="gmap3" class="fill"></div>
								<div id="olmap3" class="fill"></div>
							</div>
							<div id="wrapper3">
								<div id="location3" style="float: right"></div>
								<div id="scale3" class="escala"></div>
							</div>
						</p:panelGrid>

						<p:panelGrid columns="1" style="width: 100%">
							<h:outputLabel value="#{messages.ultima_hora}" />
							<div id="map1" style="height: 700px">
								<div id="gmap1" class="fill"></div>
								<div id="olmap1" class="fill"></div>
							</div>
							<div id="wrapper1">
								<div id="location1" style="float: right"></div>
								<div id="scale1" class="escala"></div>
							</div>
						</p:panelGrid>


					</p:panelGrid>
					<p:panelGrid columns="2" style="width: 100%; ">
						<h:panelGroup>
							<h:outputLabel value="#{messages.referencias}:" />
							<p:panelGrid columns="1" style="width: 100%; text-align:left">
								<h:graphicImage rendered="true"
									value="#{messages.wms}?request=GetLegendGraphic&amp;format=image%2Fpng&amp;width=20&amp;height=20&amp;layer=wspCirsa%3AsgaViewSeveridadLocal&amp;transparent=false&amp;LEGEND_OPTIONS=forceRule:True;borderColor:0000ff;border:true;fontSize:16;font-family:Arial" />
							</p:panelGrid>
						</h:panelGroup>
						
					</p:panelGrid>




					<p:panelGrid id="pDisclaimer" columns="1" style="width: 100%;">
						<h:outputText value="#{messages.disclaimer}" escape="false" />
						<p:panelGrid columns="1" style="width: 100%; text-align:right">
							<h:graphicImage rendered="true" value="/images/logo.png" />
						</p:panelGrid>
					</p:panelGrid>


				</p:fieldset>
			</h:form>


			<script src="ol.js" type="text/javascript"></script>
			<script src="mapaSeveridadLocal1.js" type="text/javascript" />
			<script src="mapaSeveridadLocal3.js" type="text/javascript" />
			<script src="mapaSeveridadLocal6.js" type="text/javascript" />

			<script type="text/javascript">
				function reloadMaps() {
					var pDateSelected = document.getElementById('frmMapa:idCalendarSelection_input').value;

					// mapa 1 hora
					var viewparams = [ 'p_intervalo:1', 'p_fecha:' + pDateSelected ];
					var source = untiled1.getSource();
					var params = source.getParams();
					params.viewparams = viewparams.join(';');
					source.updateParams(params);

					var viewparamsDrenaje = [ 'p_fecha:' + pDateSelected ];
					var sourceDrenaje = untiledDrenaje1.getSource();
					var paramsDrenaje = sourceDrenaje.getParams();
					paramsDrenaje.viewparams = viewparamsDrenaje;
					sourceDrenaje.updateParams(paramsDrenaje);

					var viewparams3 = [ 'p_intervalo:3', 'p_fecha:' + pDateSelected ];
					var source3 = untiled3.getSource();
					var params3 = source3.getParams();
					params3.viewparams = viewparams3.join(';');
					source3.updateParams(params3);

					var viewparams6 = [ 'p_intervalo:6', 'p_fecha:' + pDateSelected ];
					var source6 = untiled6.getSource();
					var params6 = source6.getParams();
					params6.viewparams = viewparams6.join(';');
					source6.updateParams(params6);

				}
			</script>
		</ui:define>
	</ui:composition>

</h:body>

</html>

