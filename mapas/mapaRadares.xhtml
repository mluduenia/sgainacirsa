<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui">

<h:body>

	<ui:composition template="#{empty request.remoteUser?'../template/templateinfo.xhtml':'../template/template.xhtml'}">
		<ui:define name="content">

			<style type="text/css">
.ui-panelgrid .ui-panelgrid-cell {
	border-style: none;
}
</style>

			<!--  -->
			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdR06M2wq1XRh73M-egCkmnuD3Vzw91SU" type="text/javascript" />

			<!-- viejo
			<script src="https://maps.google.com/maps/api/js?key=AIzaSyA7ZKV8MMQrPXgbDJerCLWG1_NhnFDqGd0&amp;v=3"></script>
	-->
			<h:form id="frmMapa">

				<p:poll id="poll_update" widgetVar="wv_poll_autoupdate" interval="300" listener="#{mapsLoaderMB.reset}" oncomplete="changeStartDate()" update="idCalendarSelection" />
				<p:messages id="messages" showDetail="true" escape="false" />

				<p:ajaxStatus style="width:16px;height:16px;" id="ajaxStatusPanel">
					<f:facet name="start">
						<h:graphicImage value="../images/ajaxloadingbar.gif" />
					</f:facet>
					<f:facet name="complete">
						<h:outputText value="" />
					</f:facet>
				</p:ajaxStatus>

				<p:panelGrid columns="1" style="width: 100%; text-align:right;">
					<p:selectBooleanCheckbox styleClass="booleanCheckbox" itemLabel="#{messages.actualizar_automaticamente}" value="#{mapsPreferencesMB.actualizar}">
						<p:ajax listener="#{mapsPreferencesMB.setAutoUpdate}" update=":frmMapa:messages" />
					</p:selectBooleanCheckbox>
				</p:panelGrid>

				<p:fieldset legend="#{messages.radar_cordoba}">

					<p:panelGrid columns="2" style="width: 100%">
						<p:panelGrid columns="1" style="width: 100%; text-left">
							<h:panelGroup>
								<p:commandButton id="play" widgetVar="wbPlay" disabled="true" value="Iniciar" icon="ui-icon-play" onclick="play();PF('wbPlay').disable();PF('wbStop').enable();PF('wvSlider').enable();" />
								<p:commandButton id="pause" widgetVar="wbStop" disabled="true" value="Parar" icon=" ui-icon-stop" onclick="stop(); PF('wbStop').disable();PF('wbPlay').enable();PF('wvSlider').disable();" />
								<span id="infofecha"></span>
								<span id="infoimagen" style="color: red"> </span>
							</h:panelGroup>
							<h:panelGroup>
								<h:outputText id="output" value="Una imagen cada 1000ms." />
								<h:inputHidden id="txt5" value="1000" />
								<p:slider widgetVar="wvSlider" for="txt5" step="100" display="output" minValue="500" maxValue="2000" style="width: 200px" displayTemplate="Una imagen cada {value}ms."
									onSlideEnd="changeRate(this.getValue());" />
							</h:panelGroup>
						</p:panelGrid>

						<p:panelGrid id="panelFecha" columns="1" style="width: 100%; text-align:right">
							<h:outputLabel value=" " />
							<p:calendar id="idCalendarSelection" value="#{mapsLoaderMB.refreshDate}" pattern="dd/MM/yyyy HH:mm" showButtonPanel="true" widgetVar="wvCalendarSelection" locale="#{loginMBean.locale}">
								<p:ajax event="dateSelect" oncomplete="changeStartDate()" />
							</p:calendar>
							<h:panelGroup>
								<p:selectBooleanCheckbox styleClass="booleanCheckbox" widgetVar="wvChLayers" itemLabel="Capa severidad" value="true" onchange="changesLayerVisibility();" />
								<p:selectOneMenu style="vertical-align:middle;" id="idSelHoras" value="3" widgetVar="wvSelHoras" onchange="changeStartDate();">
									<f:selectItem itemLabel="1h" itemValue="1" />
									<f:selectItem itemLabel="3hs" itemValue="3" />
									<f:selectItem itemLabel="6hs" itemValue="6" />
								</p:selectOneMenu>
							</h:panelGroup>
						</p:panelGrid>
					</p:panelGrid>

					<!-- MAP -->
					<div id="map" class="map" style="height: 900px">
						<div id="gmap" class="fill"></div>
						<div id="olmap" class="fill">
							<div id="logos">
								<h:graphicImage value="/images/logoMI.png" style="display: block; padding:2px;width:150px;" />
								<h:graphicImage value="/images/logoSi.png" style="display: block; padding:2px;width:150px;" />
							</div>
						</div>
					</div>
					<div id="wrapper">
						<div id="location" style="float: right"></div>
						<div id="scale" class="escala"></div>
					</div>


					<ui:include src="/leyendas2.xhtml" />

					<p:spacer height="10" />


					<p:panelGrid columns="1" id="pDisclaimer">
						<h:outputText value="#{messages.disclaimer2}" escape="false" />
					</p:panelGrid>



				</p:fieldset>
			</h:form>

			<p:dialog id="dStatus" modal="true" widgetVar="wvStatusDialog" header="#{messages.msj_espere}..." draggable="false" closable="false" resizable="false">
				<h:graphicImage value="../images/ajaxloadingbar.gif" />
			</p:dialog>

			<p:dialog id="dError" modal="true" widgetVar="wvErrorDialog" header="#{messages.title_fallo_conexion}" draggable="false" closable="true" resizable="false">
				<h:outputText value="#{messages.msg_error_consulta}" />
			</p:dialog>

			<script src="../js/moment.min.js" type="text/javascript"></script>
			<script src="../js/moment-round.js" type="text/javascript"></script>
			<script src="../js/functions.js" type="text/javascript"></script>


			<script src="ol.js" type="text/javascript"></script>


			<script type="text/javascript">
				//<![CDATA[

				function changesLayerVisibility() {
					untiledDrenaje.setVisible(PrimeFaces.widgets["wvChLayers"].input.is(':checked'));
					untiled.setVisible(PrimeFaces.widgets["wvChLayers"].input.is(':checked'));
				}

				function reloadMaps(pDateSelected) {
					var hsSel = PF('wvSelHoras').getJQ().find(':selected').val();

					var viewparamsDrenaje = [ 'p_fecha:' + pDateSelected ];
					var sourceDrenaje = untiledDrenaje.getSource();
					var paramsDrenaje = sourceDrenaje.getParams();
					paramsDrenaje.viewparams = viewparamsDrenaje;
					sourceDrenaje.updateParams(paramsDrenaje);

					var viewparams = [ 'p_intervalo:' + hsSel, 'p_fecha:' + pDateSelected ];
					var source = untiled.getSource();
					var params = source.getParams();
					params.viewparams = viewparams.join(';');
					source.updateParams(params);

					radarLayer.setZIndex(0);
					untiledDrenaje.setZIndex(1);
					untiled.setZIndex(2);

				}
				//]]>
			</script>



			<script src="mapaRadares.js?version=12" type="text/javascript"></script>
		</ui:define>
	</ui:composition>

</h:body>

</html>
